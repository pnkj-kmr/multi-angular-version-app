<div class="container">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h1>Audit Logs</h1>
    <button class="btn btn-secondary" routerLink="/home">Back to Home</button>
  </div>

  <div class="card">
    <h2 style="margin-bottom: 20px;">Filters</h2>
    
    <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
      <div class="form-group" style="flex: 1; min-width: 200px;">
        <label for="actionFilter">Action</label>
        <select
          id="actionFilter"
          class="form-control"
          [(ngModel)]="selectedAction"
          (change)="onFilterChange()"
          style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
        >
          <option value="">All Actions</option>
          <option *ngFor="let action of actions" [value]="action">
            {{ getActionLabel(action) }}
          </option>
        </select>
      </div>

      <div class="form-group" style="flex: 1; min-width: 200px;">
        <label for="usernameFilter">Username</label>
        <input
          type="text"
          id="usernameFilter"
          class="form-control"
          [(ngModel)]="selectedUsername"
          (input)="onFilterChange()"
          placeholder="Filter by username"
          style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"
        />
      </div>

      <div style="display: flex; align-items: flex-end;">
        <button class="btn btn-secondary" (click)="clearFilters()" style="height: 40px;">
          Clear Filters
        </button>
      </div>
    </div>
  </div>

  <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2>Activity Log</h2>
      <button class="btn btn-primary" (click)="loadAuditLogs()">Refresh</button>
    </div>

    <div *ngIf="errorMessage" class="error-message" style="margin-bottom: 15px;">
      {{ errorMessage }}
    </div>

    <div *ngIf="isLoading" style="text-align: center; padding: 20px;">
      Loading audit logs...
    </div>

    <div *ngIf="!isLoading && auditLogs.length === 0" style="text-align: center; padding: 20px;">
      No audit logs found.
    </div>

    <div *ngIf="!isLoading && auditLogs.length > 0">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Timestamp</th>
            <th>User</th>
            <th>Action</th>
            <th>Resource</th>
            <th>IP Address</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let log of auditLogs">
            <td>{{ log.id }}</td>
            <td>{{ log.created_at | date:'short' }}</td>
            <td>{{ log.username }}</td>
            <td>
              <span [class]="'badge ' + getActionClass(log.action)">
                {{ getActionLabel(log.action) }}
              </span>
            </td>
            <td>
              <span *ngIf="log.resource_type">
                {{ log.resource_type }}
                <span *ngIf="log.resource_id">#{{ log.resource_id }}</span>
              </span>
              <span *ngIf="!log.resource_type">-</span>
            </td>
            <td>{{ log.ip_address || '-' }}</td>
            <td>
              <details *ngIf="log.details" style="cursor: pointer;">
                <summary style="color: #007bff;">View Details</summary>
                <pre style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px; font-size: 12px; max-width: 300px; overflow-x: auto;">{{ parseDetails(log.details) | json }}</pre>
              </details>
              <span *ngIf="!log.details">-</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>



